
\chapter{Supported SQL}

This chapter describes the SQL syntax and extensions that \csvsqldb{} supports. As mentioned previously, not all SQL constructs make sense for a readonly non-persistent database and we have excluded or adapted features in order to work properly. However, \csvsqldb{} follows the SQL standard ISO/IEC 9075-2:2011 \cite{ISO_SQL_Standard} as closely as possible wherever applicable. So, with minimal standard SQL knowledge you should be able to use \csvsqldb{} to your advantage, as most of the SQL will look very familiar.

\section{SQL Syntax}
We describe the SQL syntax using so called syntax diagrams \cite{Wikipedia_Syntaxdiagram}. In general the syntax can be understood much easier using these kind of diagrams rather than using EBNF grammars, which are much harder to decipher.

\tikzset{
font=\scriptsize\ttfamily,
node distance=5mm,
terminal/.style={rounded rectangle,draw=blue!50,fill=blue!10,thick,minimum size=4mm, text height=1.2ex,text depth=.25ex},
nonterminal/.style={rectangle,draw=blue!50,fill=green!10,thick,minimum size=4mm, text height=1.2ex,text depth=.25ex},
every path/.style = {draw, > = latex},
point/.style={circle,inner sep=0pt,minimum size=0pt,fill=black},
endpoint/.style={circle,inner sep=1.2pt,minimum size=0pt,draw=black},
startpoint/.style={circle,inner sep=1pt,minimum size=0pt,fill=black},
hv path/.style={to path={-| (\tikztotarget)}},
vh path/.style={to path={|- (\tikztotarget)}}
}

\subsubsection{SELECT\_STMT}

\begin{figure}[!htbp]
\begin{tikzpicture}
\matrix[row sep=1mm,column sep=2mm] {
% First row:
& & & & & & & & & \node (comma) [terminal] {,}; & & & & \\
% Second row:
\node (p1) [startpoint] {}; & \node (select) [terminal] {SELECT};                                                 &
\node (p2) [point] {}; &                                                                                                      &
\node (p3) [point] {}; & \node (select list) [nonterminal] {SELECT\_LIST};                            &
\node (p4) [point] {}; & \node (from) [terminal] {FROM};                                                     &
\node (p5) [point] {}; & \node (table reference) [nonterminal] {TABLE\_REFERENCE};           &
\node (p6) [point] {}; & \node (table expressions) [nonterminal] {TABLE\_EXPRESSIONS};    &
\node (p7) [point] {}; & \node (p8) [endpoint] {}; \\
% Third row:
& & & \node (distinct) [terminal] {DISTINCT}; & & & & & & & & & &  \\
% Fourth row:
& & & \node (all) [terminal] {ALL}; & & & & & & & & & & \\
};

\graph [use existing nodes] {
  p1 -> select -- p3 -> select list -> from -> table reference -> table expressions -- p7 -> p8;
  distinct <-[hv path] p2;
  p3 <-[vh path] distinct;
  all <-[hv path] p2;
  p3 <-[vh path] all;
  comma ->[hv path] p5;
  p6 ->[vh path] comma;
};
\fill[black] (p8) circle (0.5pt);
\end{tikzpicture}
\end{figure}

\subsubsection{SELECT\_LIST}

\begin{figure}[!htbp]
\begin{tikzpicture}
\matrix[row sep=1mm,column sep=2mm] {
% First row:
& & & & & & \node (comma) [terminal] {,}; & & & \\
% Second row:
\node (p1) [startpoint] {}; & \node (p2) [point] {}; & \node (asterisk) [terminal] {ASTERISK}; &
&  &                                                                                    &
&  &                                                                                    &
& \node (p5) [point] {}; & \node (p6) [point] {}; & \node (p7) [endpoint] {}; \\
% Third row:
& & \node (expression) [nonterminal] {EXPRESSION}; & \node (p3) [point] {}; & & & & & & \\
% Fourth row:
& & &  &  & &  \node (p4) [point] {}; & \node (identifier) [nonterminal] {IDENTIFIER}; & & \\
% Fifth row:
& & & &  & \node (as) [terminal] {AS}; & & & & \\
};

\graph [use existing nodes] {
  p1 -- p2 -> asterisk  -- p5 -- p6 -> p7;
  expression <-[hv path] p2;
  p5 <-[vh path] expression;
  p5 <-[vh path] identifier;
  identifier <-[hv path] p3;
  as <-[hv path] p3;
  p4 <-[vh path] as;
  p5 ->[vh path] comma;
  comma ->[hv path] p2;
};
\fill[black] (p7) circle (0.5pt);
\end{tikzpicture}
\end{figure}

\section{Data Types}
\csvsqldb{} has an ample set of datatypes. 

\begin{FseTabular}{Data Types}{p{3.5cm}p{7.5cm}}{data_types}
\textbf{Type} & \textbf{Summary} \\
\midrule
BOOL & TRUE, FALSE, or UNKNOWN \\
BOOLEAN & Same as BOOL \\
INT & Signed 64-bit integer \\
INTEGER & Same as INT \\
FLOAT & IEEE 754 64-bit floating point number \\
DOUBLE & Same as FLOAT \\
REAL & Same as FLOAT \\
VARCHAR & Variable character string \\
CHAR & Single character \\
CHARACTER & Same as CHAR \\
DATE & Date \\
TIME & Time \\
TIMESTAMP & Timestamp \\
\end{FseTabular}

\subsection{Operations on Data Types}

\subsubsection{Boolean}

\begin{FseTabular}{Boolean Operations}{p{3.5cm}p{3.0cm}p{3.0cm}p{4.0cm}}{data_types}
\textbf{Operator} & \textbf{Kind} & \textbf{Resulting Type} & \textbf{Description} \\
\midrule
\end{FseTabular}

\subsubsection{Integer}

\subsubsection{Real}

\subsubsection{Character String}

\subsubsection{Date}

\subsubsection{Time}

\subsubsection{Timestamp}

\subsection{Conversion Matrix}

\section{Functions}

\subsection{Aggregation Functions}

Functions that aggregate rows.

\begin{FseTabular}{Aggregation Functions}{p{3.5cm}p{7.5cm}p{3.5cm}}{aggr_functions}
\textbf{Function Name} & \textbf{Summary} & \textbf{Category} \\
\midrule
SUM & Calculates the rows sum & Math Functions \\
MIN & Calculates the rows min value & Math Functions \\
MAX & Calculates the rows max value & Math Functions \\
AVG & Calculates the rows average  & Math Functions \\
COUNT & Returns the number of rows & General \\
ARBITRARY & Returns some row non-NULL value & General \\
\end{FseTabular}

\subsection{General Functions}

General functions.

\begin{FseTabular}{Build-In Functions}{p{3.5cm}p{7.5cm}p{3.5cm}}{functions}
\textbf{Function Name} & \textbf{Summary} & \textbf{Category} \\
\midrule
CAST & Cast to another type & Conversion \\
CHARACTER\_LENGTH & Returns the length in byte of the given string & String Manipulation \\
CHAR\_LENGTH & Returns the length in byte of the given string & String Manipulation \\
CURRENT\_DATE & Returns the current date & Date \& Time Functions\\
CURRENT\_TIME & Returns the current time in the local timezone & Date \& Time Functions \\
CURRENT\_TIMESTAMP & Returns the current time in the local timezone & Date \& Time Functions \\
DATE\_FORMAT & Formats a date according to the specified pattern & Date \& Time Functions \\
DATE\_TRUNC & Truncates the given timestamp according to the specified precision & Date \& Time Functions \\
EXTRACT & Extracts the specified parts from a timestamp & Date \& Time Functions \\
LOWER & Converts the given string to lower case & String Manipulation \\
POW & Returns the number raised to the specified power & Math Functions \\
TIMESTAMP\_FORMAT & Formats a timestamp according to the specified pattern & Date \& Time Functions \\
TIME\_FORMAT & Formats a time according to the specified pattern & Date \& Time Functions \\
UPPER & Converts the given string to upper case & String Manipulation \\
VERSION & Returns the version of the \csvsqldb{} & Misc \\
\end{FseTabular}

\section{Restrictions}
